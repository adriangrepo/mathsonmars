function t(){window.onLoad=omgParticlesII()}function n(t,n){return Math.floor(Math.random()*(n-t+1)+t)}function omgParticlesII(){function t(){var t=d3.mouse(this);r=t[0],i=t[1],d3.event.preventDefault()}var n=Math.max(960,innerWidth),e=Math.max(500,innerHeight),r=n/2,i=e/2,a=r,o=i,s=0,c=200,d=2*Math.PI,u=d3.select(".activity_result_banner").append("canvas").attr("width",n).attr("height",e).attr("position","relative").attr("z-index","20").on("ontouchstart"in document?"touchmove":"mousemove",t),h=u.node().getContext("2d");h.globalCompositeOperation="lighter",h.lineWidth=2,d3.timer(function(){h.clearRect(0,0,n,e);var t=d3.hsl(++s%360,1,.5).rgb(),u="rgba("+t.r+","+t.g+","+t.b+",",l=a+=.1*(r-a),f=o+=.1*(i-o);d3.select({}).transition().duration(2e3).ease(Math.sqrt).tween("circle",function(){return function(t){h.strokeStyle=u+(1-t)+")",h.beginPath(),h.arc(l,f,c*t,0,d),h.stroke()}})})}function e(){var t=700,n=300,e=d3.select("#line").append("svg").attr("width",t).attr("height",n).attr("id","visualization").attr("xmlns","http://www.w3.org/2000/svg"),r=d3.range(11).map(function(){return 10*Math.random()}),i=d3.scale.linear().domain([0,10]).range([0,700]),a=d3.scale.linear().domain([0,10]).range([10,290]),o=d3.svg.line().interpolate("cardinal").x(function(t,n){return i(n)}).y(function(t){return a(t)}),s=e.append("path").attr("d",o(r)).attr("stroke","steelblue").attr("stroke-width","2").attr("fill","none"),c=s.node().getTotalLength();s.attr("stroke-dasharray",c+" "+c).attr("stroke-dashoffset",c).transition().duration(2e3).ease("linear").attr("stroke-dashoffset",0),e.on("click",function(){s.transition().duration(2e3).ease("linear").attr("stroke-dashoffset",c)})}function r(t){function n(t){moves=0,start=+new Date,lastCount=null,graph=r(i(t)),e()}function e(){count=o(graph.links),counter.text(count?count+".":"0! Well done!");var t=lines.selectAll("line").data(graph.links);t.enter().append("line"),t.exit().remove(),t.attr("x1",function(t){return x(t[0][0])}).attr("y1",function(t){return y(t[0][1])}).attr("x2",function(t){return x(t[1][0])}).attr("y2",function(t){return y(t[1][1])}).classed("intersection",highlightIntersections?function(t){return t.intersection}:!0);var n=nodes.selectAll("circle").data(graph.nodes);n.enter().append("circle").attr("r",p-1).call(d3.behavior.drag().origin(function(t){return{x:x(t[0]),y:y(t[1])}}).on("drag",function(t){t[0]=Math.max(0,Math.min(1,x.invert(d3.event.x)))+1e-4*Math.random(),t[1]=Math.max(0,Math.min(1,y.invert(d3.event.y)))+1e-4*Math.random(),e()}).on("dragend",function(){moveCounter.text(++moves+" move"+(1!==moves?"s":""))})),n.exit().remove(),n.attr("cx",function(t){return x(t[0])}).attr("cy",function(t){return y(t[1])}).classed("intersection",highlightIntersections?function(t){return t.intersection}:count)}function r(t){if(t.nodes.length<4)return t;do t.nodes.forEach(function(t){t[0]=Math.random(),t[1]=Math.random()});while(!o(t.links));return t}function i(t){for(var n,e=[],r=[],i=-1;++i<t;)e[i]=[Math.random(),Math.random()];for(i=-1;++i<t;)a([e[i],e[~~(Math.random()*t)]],r);for(i=-1;++i<t;)for(n=i;++n<t;)a([e[i],e[n]],r);return{nodes:e,links:r}}function a(t,n){n.some(function(n){return s(t,n)})||n.push(t)}function o(t){for(var n,e,r=t.length,i=-1,a=0;++i<r;)(e=t[i]).intersection=!1,e[0].intersection=!1,e[1].intersection=!1;for(i=-1;++i<r;)for(e=t[i],n=i;++n<r;)s(e,t[n])&&(e.intersection=e[0].intersection=e[1].intersection=t[n].intersection=t[n][0].intersection=t[n][1].intersection=!0,a++);return a}function s(t,n){if(t[0]===n[0]&&t[1]===n[1]||t[0]===n[1]&&t[1]===n[0])return!0;var e=t[0],r=[t[1][0]-e[0],t[1][1]-e[1]],i=n[0],a=[n[1][0]-i[0],n[1][1]-i[1]],o=c(r,a),s=[i[0]-e[0],i[1]-e[1]],d=c(s,a)/o,u=c(s,r)/o,h=1e-6;return d>h&&1-h>d&&u>h&&1-h>u}function c(t,n){return t[0]*n[1]-t[1]*n[0]}w=960,h=600,p=15,x=d3.scale.linear().range([0,w]),y=d3.scale.linear().range([0,h]),start,format=d3.format(",.1f"),moves=0,highlightIntersections=!1,count=0,graph=r(i(t)),d3.select("#vis").selectAll("*").remove(),vis=d3.select("#vis").append("svg").attr("width",w+2*p).attr("height",h+2*p).append("g").attr("transform","translate("+[p,p]+")"),lines=vis.append("g"),nodes=vis.append("g"),counter=d3.select("#count"),moveCounter=d3.select("#move-count"),timer=d3.select("#timer"),d3.select("#generate").on("click",n),d3.select("#intersections").on("change",function(){highlightIntersections=this.checked,e()}),n(t),d3.timer(function(){count&&timer.text(format((+new Date-start)/1e3))})}function i(){function t(){var t=brush.extent();point.each(function(t){t.scanned=t.selected=!1}),e(quadtree,t[0][0],t[0][1],t[1][0],t[1][1]),point.classed("scanned",function(t){return t.scanned}),point.classed("selected",function(t){return t.selected})}function n(t){var n=[];return t.visit(function(t,e,r,i,a){n.push({x:e,y:r,width:i-e,height:a-r})}),n}function e(t,n,e,r,i){t.visit(function(t,a,o,s,c){var d=t.point;return d&&(d.scanned=!0,d.selected=d[0]>=n&&d[0]<r&&d[1]>=e&&d[1]<i),a>=r||o>=i||n>s||e>c})}width=960,height=500,data=d3.range(5e3).map(function(){return[Math.random()*width,Math.random()*width]}),quadtree=d3.geom.quadtree().extent([[-1,-1],[width+1,height+1]])(data),brush=d3.svg.brush().x(d3.scale.identity().domain([0,width])).y(d3.scale.identity().domain([0,height])).extent([[100,100],[200,200]]).on("brush",t),svg=d3.select("body").append("svg").attr("width",width).attr("height",height),svg.selectAll(".node").data(n(quadtree)).enter().append("rect").attr("class","node").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}),point=svg.selectAll(".point").data(data).enter().append("circle").attr("class","point").attr("cx",function(t){return t[0]}).attr("cy",function(t){return t[1]}).attr("r",4),svg.append("g").attr("class","brush").call(brush),t()}